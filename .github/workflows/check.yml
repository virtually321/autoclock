name: æç®€æ‰“å¡ç³»ç»Ÿ
on: 
  schedule: 
    - cron: '0 0,8 * * *'     # UTC 0:00ï¼ˆåŒ—äº¬æ—¶é—´8:00ï¼‰ã€UTC 8:00ï¼ˆåŒ—äº¬æ—¶é—´16:00ï¼‰
      time_zone: Asia/Shanghai  # æ˜¾å¼å£°æ˜æ—¶åŒº
  push: 
    paths: 
      - '**/duty'               # åŒ¹é…ä»»æ„ç›®å½•ä¸‹çš„dutyæ–‡ä»¶
      - '**/leave'              # åŒ¹é…ä»»æ„ç›®å½•ä¸‹çš„leaveæ–‡ä»¶

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4  # æ£€å‡ºä»£ç 

    - name: ç”ŸæˆçŠ¶æ€
      run: |
        set -o errexit -o nounset  # ä¸¥æ ¼æ¨¡å¼ï¼ˆæ•è·æœªå®šä¹‰å˜é‡/å‘½ä»¤é”™è¯¯ï¼‰
        
        # é˜²å¾¡æ€§æ–‡ä»¶æ£€æŸ¥ï¼ˆç¡®ä¿duty/leaveå­˜åœ¨ï¼Œé¿å…grepæŠ¥é”™ï¼‰
        for file in duty leave; do
          [ -f "$file" ] || touch "$file"
        done

        # ç²¾ç¡®åŒ¹é…duty/leaveä¸­çš„ä»Šæ—¥æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
        if grep -qxF "$(date +%F)" duty leave; then
          echo 1 > status  # å­˜åœ¨å½“æ—¥è®°å½• â†’ æ ‡è®°ä¼‘æ¯
        elif curl -sfm5 "https://yasumi.neko7ina.com/" > status; then
          echo "::info:: æ¥å£è¿”å›å‡æœŸçŠ¶æ€"  # æ¥å£æˆåŠŸ â†’ å†™å…¥çŠ¶æ€
        else
          echo "::warning file=status-check.sh::æ¥å£è¶…æ—¶/é”™è¯¯ï¼Œé»˜è®¤å·¥ä½œæ—¥"
          echo 0 > status  # å…œåº• â†’ é»˜è®¤å·¥ä½œæ—¥
        fi

    - uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ğŸ“… ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°"
        file_pattern: status       # ä»…æäº¤statusæ–‡ä»¶
        commit_options: '--allow-empty'  # å…è®¸ç©ºæäº¤ï¼ˆé¿å…æ— å˜åŒ–æ—¶æŠ¥é”™ï¼‰
