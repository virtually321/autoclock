name: âœ… Check Duty/ä¼‘ç­çŠ¶æ€å¹¶æäº¤ status.txt

on:
  schedule:
    - cron: '0 12 * * *'  # æ¯æ—¥ UTC 12 ç‚¹ ï¼ˆåŒ—äº¬æ—¶é—´ 20:00ï¼‰
  push:
    branches:
      - main
    paths:
      - zb.txt
      - xj.txt

jobs:
  run_check:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ å…‹éš†ä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ è®¾ç½® Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.10

      - name: ğŸ“ˆ ç”Ÿæˆ status.txt
        run: python check_status.py

      - name: ğŸ§ã€DEBUGã€‘æŸ¥çœ‹ status.txt å½“å‰å†…å®¹
        run: |
          cat -e status.txt  # åŒ…å« $ ä»£è¡¨æœ«å°¾æœ‰æ¢è¡Œç¬¦
          cat status.txt     # å®é™…å€¼ 0 æˆ– 1

      - name: ğŸ§¾ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ›´æ–°
        id: check_diff_status
        run: |
          # ä¸å½“å‰åˆ†æ”¯å¯¹æ¯”ï¼Œæ£€æŸ¥ diff
          updated_status=$(git diff --no-prefix origin/main status.txt | head -n 1 | grep '^[+-]' | head -c 1)

          if [ "$updated_status" = "+" ]; then
            echo "::set-output name=changed::true"
          else
            echo "::set-output name=changed::false"
          fi

      - name: ğŸ“¤ è‡ªåŠ¨ç”Ÿæˆ Git Commit æäº¤ status.txt
        if: steps.check_diff_status.outputs.changed == 'true'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: status.txt
          commit_message: "ğŸ”” status æ›´æ–°ï¼š$(cat status.txt)"
